# ANA-004 - Revalida√ß√£o TEC vs Implementa√ß√£o Real

**Vers√£o:** 1.0
**Data:** 2025-10-25
**Autor:** Claude (An√°lise Automatizada)
**Objetivo:** Validar especifica√ß√µes TEC-001, TEC-002, TEC-003 contra implementa√ß√µes reais (ANA-002, ANA-003)

---

## 1. Sum√°rio Executivo

### 1.1. Status Geral

| Documento | Status Geral | Principais Issues |
|-----------|-------------|-------------------|
| **TEC-001** (Core DICT) | üü° **Parcial** | Reposit√≥rio n√£o analisado (fora de escopo) |
| **TEC-002** (Bridge) | üü¢ **ALINHADO** | Pequenas diverg√™ncias em nomenclatura |
| **TEC-003** (Connect) | üü° **GAPS** | VSYNC e OTP workflows ausentes na implementa√ß√£o |

### 1.2. Inconsist√™ncias Cr√≠ticas Identificadas

| ID | Severidade | Componente | Descri√ß√£o | A√ß√£o Recomendada |
|----|-----------|------------|-----------|------------------|
| **INC-001** | üî¥ Alta | TEC-003 | VSYNC Workflow n√£o implementado | Implementar ou atualizar TEC-003 |
| **INC-002** | üî¥ Alta | TEC-003 | OTP Workflow n√£o implementado | Implementar ou atualizar TEC-003 |
| **INC-003** | üü° M√©dia | TEC-002/003 | Nomenclatura de topics Pulsar inconsistente | Padronizar nomes |
| **INC-004** | üü° M√©dia | TEC-003 | Database schema n√£o expl√≠cito na implementa√ß√£o | Adicionar migrations |
| **INC-005** | üü° M√©dia | TEC-002 | Dual protocol (gRPC + Pulsar) n√£o especificado claramente | Atualizar TEC-002 |
| **INC-006** | üü¢ Baixa | TEC-003 | Estrutura multi-app melhor que especificada | Atualizar TEC-003 (enhancement) |

---

## 2. An√°lise Detalhada TEC-002 (Bridge)

### 2.1. Valida√ß√£o TEC-002 vs ANA-002

#### ‚úÖ ALINHAMENTOS CONFIRMADOS

| Aspecto TEC-002 | Implementa√ß√£o Real (ANA-002) | Status |
|-----------------|------------------------------|--------|
| **Clean Architecture** | ‚úÖ 4 camadas implementadas | ‚úÖ ALINHADO |
| **Sem Temporal Workflows** | ‚úÖ Aus√™ncia confirmada (`go.mod` sem `go.temporal.io/sdk`) | ‚úÖ ALINHADO |
| **gRPC Server** | ‚úÖ `handlers/grpc/*_controller.go` | ‚úÖ ALINHADO |
| **Pulsar Consumer** | ‚úÖ `handlers/pulsar/handler.go` | ‚úÖ ALINHADO |
| **XML Signer** | ‚úÖ `shared/signer/signature.go` (JRE + JAR) | ‚úÖ ALINHADO |
| **mTLS Support** | ‚úÖ `shared/http/client.go` com certificados | ‚úÖ ALINHADO |
| **Circuit Breaker** | ‚úÖ `sony/gobreaker/v2` | ‚úÖ ALINHADO |
| **Stateless** | ‚úÖ Sem banco de dados | ‚úÖ ALINHADO |
| **Observability** | ‚úÖ OpenTelemetry | ‚úÖ ALINHADO |

#### üü° DIVERG√äNCIAS IDENTIFICADAS

##### INC-005: Dual Protocol Support (gRPC + Pulsar)

**TEC-002 Especifica:**
```markdown
### 1.1 gRPC Server (Opera√ß√µes S√≠ncronas)
...
### 1.2 Pulsar Consumer (Opera√ß√µes Ass√≠ncronas)
```

**Implementa√ß√£o Real (ANA-002):**
- ‚úÖ **AMBOS** gRPC e Pulsar implementados **simultaneamente**
- Bridge pode receber requisi√ß√µes via gRPC **OU** Pulsar

**An√°lise:**
- TEC-002 menciona ambos protocolos, mas n√£o deixa claro se:
  - S√£o **alternativos** (ou um ou outro)
  - S√£o **complementares** (ambos ativos simultaneamente)

**Evid√™ncia:**
```
handlers/
‚îú‚îÄ‚îÄ grpc/              # ‚úÖ gRPC Server implementado
‚îÇ   ‚îú‚îÄ‚îÄ claim_controller.go
‚îÇ   ‚îî‚îÄ‚îÄ directory_controller.go
‚îî‚îÄ‚îÄ pulsar/            # ‚úÖ Pulsar Consumer implementado
    ‚îú‚îÄ‚îÄ handler.go
    ‚îú‚îÄ‚îÄ claim_handler.go
    ‚îî‚îÄ‚îÄ directory_handler.go
```

**Impacto:** üü° M√©dio
**Recomenda√ß√£o:**
1. **Atualizar TEC-002** para especificar claramente dual protocol support
2. Adicionar se√ß√£o de "Modos de Opera√ß√£o":
   - **Modo H√≠brido** (gRPC + Pulsar): Ambos ativos
   - Documentar quando usar cada protocolo (s√≠ncrono vs ass√≠ncrono)

##### INC-003: Nomenclatura de Topics Pulsar

**TEC-002 Especifica:**
```markdown
**Topics Pulsar**:
- **Entrada**: `bridge-dict-req-in` (consome requisi√ß√µes do Connect)
- **Sa√≠da**: `bridge-dict-res-out` (publica respostas para o Connect)
```

**IcePanel (ANA-001) Documenta:**
```
- rsfn-dict-req-out (requests)
- rsfn-dict-res-out (responses)
```

**Implementa√ß√£o Real (ANA-002):**
- Nomes de topics **n√£o expl√≠citos** no c√≥digo analisado
- Provavelmente configur√°veis via environment variables

**An√°lise:**
- **Inconsist√™ncia de nomenclatura** entre TEC-002 e IcePanel
- TEC-002: `bridge-dict-req-in` / `bridge-dict-res-out`
- IcePanel: `rsfn-dict-req-out` / `rsfn-dict-res-out`

**Impacto:** üü° M√©dio
**Recomenda√ß√£o:**
1. **Padronizar nomenclatura** seguindo IcePanel (arquitetura oficial)
2. **Atualizar TEC-002** para usar:
   - `rsfn-dict-req-out` (entrada do Bridge, sa√≠da do Connect)
   - `rsfn-dict-res-out` (sa√≠da do Bridge, entrada do dict.api)
3. Configurar via `PULSAR_TOPIC_REQ` e `PULSAR_TOPIC_RES`

#### ‚úÖ RESPONSABILIDADES CONFIRMADAS

**TEC-002 Define:**
> Bridge FAZ:
> - Receber requisi√ß√µes (gRPC/Pulsar)
> - Preparar payloads SOAP/XML
> - Assinar XML com certificado ICP-Brasil
> - Enviar requisi√ß√µes mTLS para Bacen
> - Retornar respostas

**ANA-002 Confirma:**
```go
// Use Case Pattern
func (uc *ProcessDirectoryRequestUseCase) Execute(ctx context.Context, req *DirectoryRequest) (*DirectoryResponse, error) {
    // 1. Mapeia request para payload SOAP
    soapPayload := uc.buildSOAPPayload(req)

    // 2. Assina XML com certificado ICP-Brasil
    signedXML, err := uc.xmlSigner.Sign(ctx, soapPayload)

    // 3. Envia para Bacen via mTLS
    response, err := uc.rsfnClient.Send(ctx, signedXML)

    // 4. Retorna resposta (sem armazenar estado)
    return response, nil
}
```

‚úÖ **Implementa√ß√£o 100% alinhada com especifica√ß√£o TEC-002 v3.0**

#### ‚úÖ OPERA√á√ïES IMPLEMENTADAS

**TEC-002 Especifica:**
- Directory Operations (CRUD)
- Claim Operations
- Reconciliation (CID, VSYNC)
- Antifraud
- Policies
- Infraction Reports

**ANA-002 Confirma:**
```
application/usecases/
‚îú‚îÄ‚îÄ antifraud/          # ‚úÖ 8 opera√ß√µes
‚îú‚îÄ‚îÄ claim/              # ‚úÖ 10 opera√ß√µes
‚îú‚îÄ‚îÄ directory/          # ‚úÖ 7 opera√ß√µes
‚îú‚îÄ‚îÄ infraction_report/  # ‚úÖ 9 opera√ß√µes
‚îú‚îÄ‚îÄ key/                # ‚úÖ 4 opera√ß√µes
‚îú‚îÄ‚îÄ policies/           # ‚úÖ 5 opera√ß√µes
‚îî‚îÄ‚îÄ reconciliation/     # ‚úÖ 8 opera√ß√µes
```

‚úÖ **TOTAL: 7 dom√≠nios, 51+ opera√ß√µes implementadas**

### 2.2. Conclus√£o TEC-002

**Status:** üü¢ **95% ALINHADO**

**Issues Pendentes:**
- üü° INC-005: Documentar dual protocol support
- üü° INC-003: Padronizar nomenclatura de topics Pulsar

**Recomenda√ß√µes:**
1. Atualizar TEC-002 v3.1 com clarifica√ß√µes sobre dual protocol
2. Alinhar nomenclatura de topics com IcePanel
3. Adicionar diagrama de sequ√™ncia para gRPC vs Pulsar flows

---

## 3. An√°lise Detalhada TEC-003 (Connect)

### 3.1. Valida√ß√£o TEC-003 vs ANA-003

#### ‚úÖ ALINHAMENTOS CONFIRMADOS

| Aspecto TEC-003 | Implementa√ß√£o Real (ANA-003) | Status |
|-----------------|------------------------------|--------|
| **Temporal SDK** | ‚úÖ `go.temporal.io/sdk v1.36.0` | ‚úÖ ALINHADO |
| **Multi-App Architecture** | ‚úÖ `apps/dict/` + `apps/orchestration-worker/` | ‚úÖ MELHOR que especificado |
| **Claims Workflow** | ‚úÖ `CreateClaimWorkflow` + child workflows | ‚úÖ ALINHADO |
| **Temporal Activities** | ‚úÖ ~10 activities (claims, cache, events) | ‚úÖ ALINHADO |
| **Bridge gRPC Client** | ‚úÖ `infrastructure/grpc/client.go` | ‚úÖ ALINHADO |
| **Pulsar Integration** | ‚úÖ Consumer + Producer | ‚úÖ ALINHADO |
| **API REST** | ‚úÖ Fiber + Huma (melhor que especificado) | ‚úÖ ALINHADO+ |
| **Redis Cache** | ‚úÖ `go-redis/v9` | ‚úÖ ALINHADO |
| **Observability** | ‚úÖ OpenTelemetry | ‚úÖ ALINHADO |

#### üî¥ GAPS CR√çTICOS IDENTIFICADOS

##### INC-001: VSYNC Workflow Ausente

**TEC-003 Especifica:**
```go
## 2.2. VSYNCWorkflow (Verifica√ß√£o de Sincroniza√ß√£o Di√°ria)

**Responsabilidade**: Executar VSYNC di√°rio (00:00 BRT) para reconciliar contas PIX.

**Caracter√≠sticas**:
- **Cron Schedule**: Di√°rio √†s 00:00 BRT
- **Dura√ß√£o**: ~2-4 horas (dependendo do volume)
- **Retry Policy**: Retry infinito at√© sucesso
```

**Implementa√ß√£o Real (ANA-003):**
- ‚ùå **VSYNC Workflow N√ÉO identificado** no c√≥digo analisado
- Nenhum arquivo matching `vsync_workflow.go` ou similar
- Nenhuma configura√ß√£o de cron job encontrada

**Busca Realizada:**
```bash
find apps/orchestration-worker -name "*vsync*" -type f
# Resultado: Nenhum arquivo encontrado
```

**Impacto:** üî¥ **ALTO**
- VSYNC √© **requisito regulat√≥rio cr√≠tico** do Bacen
- Aus√™ncia pode significar:
  1. Ainda n√£o implementado (backlog)
  2. Implementado em branch separada
  3. Implementado de forma diferente (outro nome)

**Recomenda√ß√£o:**
1. **URGENTE**: Confirmar status de VSYNC workflow
2. Se n√£o implementado: Priorizar implementa√ß√£o
3. Se em branch separada: Documentar em TEC-003
4. Se implementado diferente: Atualizar ANA-003 e TEC-003

##### INC-002: OTP Workflow Ausente

**TEC-003 Especifica:**
```go
## 2.3. OTPWorkflow (Valida√ß√£o de One-Time Password)

**Responsabilidade**: Validar c√≥digos OTP para opera√ß√µes sens√≠veis.

**Caracter√≠sticas**:
- **Timeout**: 5 minutos
- **Signal**: "otp-validated" (sucesso) ou timeout (falha)
```

**Implementa√ß√£o Real (ANA-003):**
- ‚ùå **OTP Workflow N√ÉO identificado** no c√≥digo analisado
- Nenhum arquivo matching `otp_workflow.go` ou similar

**Busca Realizada:**
```bash
find apps/orchestration-worker -name "*otp*" -type f
# Resultado: Nenhum arquivo encontrado
```

**Impacto:** üî¥ **ALTO**
- OTP pode ser **requisito de seguran√ßa** para opera√ß√µes cr√≠ticas
- Aus√™ncia pode significar:
  1. Ainda n√£o implementado (backlog)
  2. Implementado em outro servi√ßo (fora de orchestration-worker)
  3. N√£o √© requisito (TEC-003 incorreto)

**Recomenda√ß√£o:**
1. **Verificar**: OTP √© requisito real ou especifica√ß√£o excessiva?
2. Se requisito: Implementar OTPWorkflow
3. Se n√£o requisito: Remover de TEC-003 v2.1

##### INC-004: Database Schema N√£o Expl√≠cito

**TEC-003 Especifica:**
```sql
-- Tabela de Reivindica√ß√µes
CREATE TABLE claims (
    id UUID PRIMARY KEY,
    entry_key VARCHAR(77) NOT NULL,
    claimer_ispb VARCHAR(8) NOT NULL,
    owner_ispb VARCHAR(8) NOT NULL,
    type VARCHAR(20) NOT NULL,
    status VARCHAR(20) NOT NULL,
    workflow_id VARCHAR(255),
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    expires_at TIMESTAMP NOT NULL,
    resolved_at TIMESTAMP
);

-- Tabela de VSYNC
CREATE TABLE vsync_accounts (
    id UUID PRIMARY KEY,
    ispb VARCHAR(8) NOT NULL,
    account_number VARCHAR(20) NOT NULL,
    ...
);
```

**Implementa√ß√£o Real (ANA-003):**
- ‚ùå **Database migrations N√ÉO encontradas** no reposit√≥rio
- Sem pasta `db/migrations/`
- Sem configs de ORM (GORM, sqlc, etc.)

**Busca Realizada:**
```bash
find connector-dict -name "*migration*" -o -name "*.sql" -type f
# Resultado: Nenhum arquivo SQL encontrado
```

**An√°lise:**
- **PostgreSQL √© depend√™ncia confirmada** (usado pelo Temporal Server)
- **Schema espec√≠fico n√£o expl√≠cito** no c√≥digo Go
- Possibilidades:
  1. Migrations em reposit√≥rio separado
  2. Gerenciado por ferramenta externa (Flyway, Liquibase)
  3. Ainda n√£o implementado

**Impacto:** üü° **M√âDIO**
**Recomenda√ß√£o:**
1. Adicionar migrations em `db/migrations/`
2. Usar `golang-migrate` ou `goose` para versionamento
3. Documentar schema no README

#### ‚úÖ WORKFLOWS IMPLEMENTADOS

**TEC-003 Especifica:**
1. ClaimWorkflow (7 dias)
2. VSYNCWorkflow (daily cron)
3. OTPWorkflow (5 min)

**ANA-003 Confirma:**

| Workflow TEC-003 | Arquivo Implementa√ß√£o | Status |
|------------------|-----------------------|--------|
| **ClaimWorkflow** | ‚úÖ `create_workflow.go` | ‚úÖ IMPLEMENTADO |
| - Monitor Status | ‚úÖ `monitor_status_workflow.go` | ‚úÖ IMPLEMENTADO |
| - Expire Period | ‚úÖ `expire_completion_period_workflow.go` | ‚úÖ IMPLEMENTADO |
| - Complete | ‚úÖ `complete_workflow.go` | ‚úÖ IMPLEMENTADO |
| - Cancel | ‚úÖ `cancel_workflow.go` | ‚úÖ IMPLEMENTADO |
| **VSYNCWorkflow** | ‚ùå N√£o encontrado | ‚ùå AUSENTE (INC-001) |
| **OTPWorkflow** | ‚ùå N√£o encontrado | ‚ùå AUSENTE (INC-002) |

**Claim Workflow Confirmado:**
```go
// infrastructure/temporal/workflows/claims/create_workflow.go
func CreateClaimWorkflow(ctx workflow.Context, input CreateClaimWorkflowInput) error {
    // 1. Activity: Criar reivindica√ß√£o no Bacen (via Bridge gRPC)
    bacenResp, err := executeCreateClaimActivity(ctx, input)

    // 2. Activity: Cachear resposta (Redis)
    workflows.ExecuteCacheActivity(ctx, input.Hash, bacenResp, false, nil)

    // 3. Activity: Publicar evento para Core (Pulsar)
    workflows.ExecuteCoreEventsPublishActivity(ctx, input.Hash, pkg.ActionCreateClaim, bacenResp)

    // 4. Activity: Publicar evento para DICT (Pulsar)
    workflows.ExecuteDictEventsPublishActivity(ctx, input.Hash, pkg.ActionCreateClaim, bacenResp)

    // 5. Child Workflow: Monitor Completion Period (30 days)
    startMonitorCompletionWorkflow(ctx, bacenResp)

    // 6. Child Workflow: Monitor Status
    startMonitorStatusWorkflow(ctx, bacenResp)

    return nil
}
```

‚úÖ **Implementa√ß√£o alinhada com TEC-003 para ClaimWorkflow**

**Observa√ß√£o:**
- TEC-003 especifica **7 dias** de monitoramento
- ANA-003 mostra **30 dias** na implementa√ß√£o:
  ```go
  timer := workflow.NewTimer(ctx, 30*24*time.Hour)
  ```

**üü° DIVERG√äNCIA MENOR:**
- TEC-003: "7 dias de monitoramento"
- Implementa√ß√£o: 30 dias (ExpireCompletionPeriodWorkflow)

**A√ß√£o:** Validar com neg√≥cio qual per√≠odo correto (7 ou 30 dias)

#### ‚úÖ TEMPORAL ACTIVITIES IMPLEMENTADAS

**TEC-003 Especifica:**
```go
- CreateClaimActivity
- ConfirmClaimActivity
- CancelClaimActivity
- GetClaimActivity
- CacheActivity
- PublishEventActivity
```

**ANA-003 Confirma:**
```
infrastructure/temporal/activities/
‚îú‚îÄ‚îÄ claims/
‚îÇ   ‚îú‚îÄ‚îÄ create_activity.go          # ‚úÖ CreateClaimGRPCActivity
‚îÇ   ‚îú‚îÄ‚îÄ complete_activity.go        # ‚úÖ CompleteClaimGRPCActivity
‚îÇ   ‚îú‚îÄ‚îÄ cancel_activity.go          # ‚úÖ CancelClaimGRPCActivity
‚îÇ   ‚îî‚îÄ‚îÄ get_claim_activity.go       # ‚úÖ GetClaimGRPCActivity
‚îú‚îÄ‚îÄ cache/
‚îÇ   ‚îî‚îÄ‚îÄ cache_activity.go           # ‚úÖ CacheActivity (Redis)
‚îî‚îÄ‚îÄ events/
    ‚îú‚îÄ‚îÄ core_events_activity.go     # ‚úÖ CoreEventsPublishActivity
    ‚îî‚îÄ‚îÄ dict_events_activity.go     # ‚úÖ DictEventsPublishActivity
```

‚úÖ **Todas activities especificadas est√£o implementadas**

#### üü¢ ENHANCEMENT: Multi-App Architecture

**TEC-003 Especifica:**
```
lb-conn/rsfn-connect/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ connect/       # Entrypoint principal
‚îÇ   ‚îî‚îÄ‚îÄ worker/        # Temporal Worker
```

**Implementa√ß√£o Real (ANA-003):**
```
connector-dict/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ dict/                    # ‚úÖ API REST (Fiber + Huma)
‚îÇ   ‚îú‚îÄ‚îÄ orchestration-worker/    # ‚úÖ Temporal Workers
‚îÇ   ‚îî‚îÄ‚îÄ shared/                  # ‚úÖ C√≥digo compartilhado
```

**An√°lise:**
- ‚úÖ **Separa√ß√£o MELHOR que especificada**
- Implementa√ß√£o separa completamente:
  - `dict/` ‚Üí API REST (83 arquivos Go)
  - `orchestration-worker/` ‚Üí Temporal Workflows (51 arquivos Go)
  - `shared/` ‚Üí Infraestrutura compartilhada

**Impacto:** üü¢ **Positivo**
**Recomenda√ß√£o:**
1. **Atualizar TEC-003 v2.1** para refletir estrutura multi-app
2. Documentar benef√≠cios da separa√ß√£o:
   - Deploy independente
   - Escalabilidade separada (API vs Workers)
   - Separa√ß√£o de responsabilidades clara

### 3.2. Conclus√£o TEC-003

**Status:** üü° **70% ALINHADO** (Gaps cr√≠ticos em VSYNC e OTP)

**Issues Pendentes:**
- üî¥ INC-001: VSYNC Workflow ausente
- üî¥ INC-002: OTP Workflow ausente
- üü° INC-004: Database schema n√£o expl√≠cito
- üü° INC-003: Nomenclatura de topics Pulsar

**Pontos Fortes:**
- ‚úÖ ClaimWorkflow completo e bem implementado
- ‚úÖ Temporal Activities alinhadas
- ‚úÖ Bridge Client via gRPC funcional
- ‚úÖ API REST com Fiber + Huma (melhor que especificado)
- ‚úÖ Multi-app architecture excelente

**Recomenda√ß√µes Priorit√°rias:**
1. **URGENTE**: Implementar VSYNC Workflow ou atualizar TEC-003
2. **URGENTE**: Esclarecer status OTP Workflow
3. Adicionar database migrations
4. Validar per√≠odo de claim (7 vs 30 dias)
5. Atualizar TEC-003 v2.1 com melhorias implementadas

---

## 4. An√°lise TEC-001 (Core DICT)

### 4.1. Status

**TEC-001** especifica o **Core DICT (dict.api)** como servi√ßo central de dom√≠nio.

**An√°lise Realizada:**
- ‚úÖ **ANA-003** confirma exist√™ncia de `apps/dict/` no reposit√≥rio `connector-dict`
- ‚úÖ Implementado com **Fiber + Huma** (API REST)
- ‚ö†Ô∏è Reposit√≥rio Core DICT separado **N√ÉO foi analisado** (fora de escopo)

**Mapeamento Arquitetural:**

| TEC-001 | Implementa√ß√£o Real |
|---------|-------------------|
| Core DICT (gRPC Server) | ‚ùì Reposit√≥rio separado n√£o analisado |
| dict.api | ‚úÖ `connector-dict/apps/dict/` (REST API) |

**Observa√ß√£o:**
- **Arquitetura IcePanel** menciona `dict.api` como componente separado
- **TEC-001** e **dict.api** podem ser o **mesmo componente**
- Necess√°rio esclarecer se:
  1. `dict.api` = TEC-001 (Core DICT)
  2. Ou s√£o componentes separados

**Recomenda√ß√£o:**
1. Esclarecer mapeamento TEC-001 ‚Üî dict.api
2. Analisar reposit√≥rio Core DICT (se existir separadamente)
3. Atualizar documenta√ß√£o arquitetural

---

## 5. Nomenclatura e Mapeamento IcePanel

### 5.1. Inconsist√™ncias de Nomenclatura (INC-003)

**Problema:** Nomes diferentes para mesmos componentes em documentos diferentes.

#### Pulsar Topics

| Documento | Nome Topic Request | Nome Topic Response |
|-----------|-------------------|---------------------|
| **TEC-002** | `bridge-dict-req-in` | `bridge-dict-res-out` |
| **TEC-003** | `dict-req-out` | `dict-res-in` |
| **IcePanel (ANA-001)** | `rsfn-dict-req-out` | `rsfn-dict-res-out` |

**An√°lise:**
- 3 nomenclaturas diferentes para mesmos topics
- Causa confus√£o entre equipes
- Necess√°rio padroniza√ß√£o

**Recomenda√ß√£o:**
1. **Adotar nomenclatura IcePanel** (arquitetura oficial):
   - `rsfn-dict-req-out` (Core ‚Üí Connect ‚Üí Bridge)
   - `rsfn-dict-res-out` (Bridge ‚Üí Connect ‚Üí Core)
2. Atualizar TEC-002 e TEC-003 v3.1 / v2.1
3. Configurar nomes via environment variables:
   ```bash
   PULSAR_TOPIC_REQ=rsfn-dict-req-out
   PULSAR_TOPIC_RES=rsfn-dict-res-out
   ```

#### Componentes

| IcePanel | TEC-002 | TEC-003 | Padroniza√ß√£o Proposta |
|----------|---------|---------|----------------------|
| DICT Proxy | RSFN Bridge | - | ‚úÖ **Bridge** (TEC-002) |
| dict.api | - | Core DICT (?) | ‚úÖ **dict.api** |
| dict.orchestration.worker | - | RSFN Connect | ‚úÖ **Connect** (orchestration-worker) |
| rsfn-dict-req-out | bridge-dict-req-in | dict-req-out | ‚úÖ **rsfn-dict-req-out** |

### 5.2. Mapeamento Consolidado

**Proposta de Padroniza√ß√£o:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  IcePanel Name            TEC Doc        Implementation Repo    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  dict.api                 TEC-001        [Reposit√≥rio separado?] ‚îÇ
‚îÇ  DICT Proxy               TEC-002        rsfn-connect-bacen-bridge‚îÇ
‚îÇ  dict.orchestration.worker TEC-003       connector-dict/apps/orchestration-worker‚îÇ
‚îÇ  worker.claims            TEC-003        workflows/claims/       ‚îÇ
‚îÇ  rsfn-dict-req-out        TEC-002/003    (Pulsar topic config)   ‚îÇ
‚îÇ  rsfn-dict-res-out        TEC-002/003    (Pulsar topic config)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 6. Tabela Consolidada de Inconsist√™ncias

| ID | Severidade | Componente | TEC Spec | Implementa√ß√£o Real | Gap | A√ß√£o Recomendada |
|----|-----------|------------|----------|-------------------|-----|------------------|
| **INC-001** | üî¥ Alta | TEC-003 | VSYNCWorkflow especificado | ‚ùå N√£o encontrado | VSYNC ausente | Implementar ou remover de TEC-003 |
| **INC-002** | üî¥ Alta | TEC-003 | OTPWorkflow especificado | ‚ùå N√£o encontrado | OTP ausente | Validar necessidade e implementar |
| **INC-003** | üü° M√©dia | TEC-002/003 | `bridge-dict-req-in` / `dict-req-out` | Nomes configur√°veis | 3 nomenclaturas diferentes | Padronizar para `rsfn-dict-*` |
| **INC-004** | üü° M√©dia | TEC-003 | Database schema detalhado | ‚ùå Migrations n√£o encontradas | Schema n√£o expl√≠cito | Adicionar `db/migrations/` |
| **INC-005** | üü° M√©dia | TEC-002 | gRPC OU Pulsar | ‚úÖ Ambos implementados | Dual protocol n√£o claro | Documentar dual support |
| **INC-006** | üü¢ Baixa | TEC-003 | Estrutura monol√≠tica | ‚úÖ Multi-app melhor | Enhancement | Atualizar TEC-003 (positivo) |
| **INC-007** | üü° M√©dia | TEC-003 | Claim 7 dias | ‚úÖ Implementado 30 dias | Per√≠odo diferente | Validar com neg√≥cio |
| **INC-008** | üü° M√©dia | TEC-001 | Core DICT | ‚ùì Repo n√£o analisado | Mapeamento unclear | Esclarecer arquitetura |

---

## 7. Plano de A√ß√£o Recomendado

### 7.1. Prioridade ALTA (Semana 1)

1. **INC-001: VSYNC Workflow**
   - [ ] Confirmar com time se VSYNC est√° implementado em outro repo/branch
   - [ ] Se ausente: Priorizar implementa√ß√£o (requisito regulat√≥rio)
   - [ ] Atualizar TEC-003 com status real

2. **INC-002: OTP Workflow**
   - [ ] Validar com seguran√ßa se OTP √© requisito real
   - [ ] Se sim: Implementar OTPWorkflow
   - [ ] Se n√£o: Remover de TEC-003 v2.1

3. **INC-003: Nomenclatura Pulsar Topics**
   - [ ] Adotar padr√£o IcePanel: `rsfn-dict-req-out` / `rsfn-dict-res-out`
   - [ ] Atualizar TEC-002 v3.1 e TEC-003 v2.1
   - [ ] Configurar via environment variables

### 7.2. Prioridade M√âDIA (Semana 2-3)

4. **INC-004: Database Migrations**
   - [ ] Adicionar `db/migrations/` em `connector-dict`
   - [ ] Implementar migrations com `golang-migrate`
   - [ ] Documentar schema no README

5. **INC-005: Dual Protocol Documentation**
   - [ ] Atualizar TEC-002 v3.1 com se√ß√£o "Dual Protocol Support"
   - [ ] Documentar quando usar gRPC vs Pulsar
   - [ ] Adicionar diagramas de sequ√™ncia

6. **INC-007: Claim Period Validation**
   - [ ] Validar com neg√≥cio: 7 dias ou 30 dias?
   - [ ] Atualizar TEC-003 ou c√≥digo conforme decis√£o

### 7.3. Prioridade BAIXA (Semana 4)

7. **INC-006: Multi-App Enhancement**
   - [ ] Atualizar TEC-003 v2.1 com estrutura multi-app
   - [ ] Documentar benef√≠cios (deploy independente, escalabilidade)

8. **INC-008: Core DICT Mapping**
   - [ ] Esclarecer mapeamento TEC-001 ‚Üî dict.api
   - [ ] Analisar reposit√≥rio Core DICT (se existir)
   - [ ] Atualizar documenta√ß√£o arquitetural

---

## 8. Versionamento Recomendado de Documentos

### 8.1. TEC-002 Bridge Specification

**Vers√£o Atual:** 3.0
**Pr√≥xima Vers√£o:** **3.1**

**Mudan√ßas Propostas:**
1. Adicionar se√ß√£o "Dual Protocol Support" (gRPC + Pulsar)
2. Atualizar nomenclatura topics para `rsfn-dict-*`
3. Adicionar diagrama de sequ√™ncia gRPC vs Pulsar

### 8.2. TEC-003 Connect Specification

**Vers√£o Atual:** 2.0
**Pr√≥xima Vers√£o:** **2.1**

**Mudan√ßas Propostas:**
1. Remover ou marcar como "Pendente": VSYNC e OTP workflows
2. Atualizar estrutura para multi-app (dict + orchestration-worker)
3. Atualizar nomenclatura topics para `rsfn-dict-*`
4. Adicionar se√ß√£o "Database Migrations"
5. Validar per√≠odo claim (7 vs 30 dias)

### 8.3. TEC-001 Core DICT Specification

**Vers√£o Atual:** 1.0
**Pr√≥xima Vers√£o:** **1.1** (se necess√°rio)

**Mudan√ßas Propostas:**
1. Esclarecer rela√ß√£o com dict.api
2. Revalidar ap√≥s an√°lise de reposit√≥rio Core DICT

---

## 9. Conclus√£o Geral

### 9.1. Status Global de Alinhamento

| Documento | Alinhamento | Principais Issues |
|-----------|------------|-------------------|
| **TEC-001** | üü° N√£o Validado | Reposit√≥rio n√£o analisado |
| **TEC-002** | üü¢ **95%** | Pequenas diverg√™ncias nomenclatura |
| **TEC-003** | üü° **70%** | VSYNC/OTP ausentes, schema n√£o expl√≠cito |

### 9.2. Qualidade da Implementa√ß√£o

**Pontos Fortes:**
- ‚úÖ **Clean Architecture** bem implementada (Bridge e Connect)
- ‚úÖ **Temporal Workflows** funcionais (Claims completo)
- ‚úÖ **Multi-App Separation** excelente (dict + orchestration-worker)
- ‚úÖ **Bridge como Adapter puro** corretamente implementado
- ‚úÖ **Observabilidade** (OpenTelemetry) desde in√≠cio

**Gaps Cr√≠ticos:**
- üî¥ **VSYNC Workflow** ausente (requisito regulat√≥rio?)
- üî¥ **OTP Workflow** ausente (requisito seguran√ßa?)
- üü° **Database Migrations** n√£o expl√≠citas
- üü° **Nomenclatura inconsistente** entre documentos

### 9.3. Recomenda√ß√£o Final

**A√ß√£o Imediata:**
1. ‚úÖ **TEC-002 est√° praticamente alinhado** - pequenos ajustes nomenclatura
2. üî¥ **TEC-003 precisa de valida√ß√£o urgente** sobre VSYNC/OTP
3. üü° **TEC-001 precisa de an√°lise** de reposit√≥rio Core DICT

**Next Steps:**
1. Executar Plano de A√ß√£o (Prioridade Alta primeiro)
2. Atualizar TEC-002 v3.1 e TEC-003 v2.1
3. Analisar reposit√≥rio Core DICT (se existir)
4. Criar ADR para padroniza√ß√£o de nomenclatura

---

**Documento gerado automaticamente via cross-validation TEC vs ANA**
**√öltima atualiza√ß√£o:** 2025-10-25
